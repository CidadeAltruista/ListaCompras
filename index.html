<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Lista de Compras</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* === Estilos originais (layout fixo, bordas, inputs, colunas sticky) === */
    table {
      table-layout: fixed;
      border-collapse: collapse;
      --first-col-width: 0px; /* será atualizado por JS */
    }
    th, td {
      border: 1px solid #4B5563;
    }
    td[data-tipo="estado"] {
      min-width: 1em;   /* ou 2ch, ou 24px, conforme o tamanho do ícone */
      max-width: 1em;
      width: 1em;
      padding-left: 0;
      padding-right: 0;
      text-align: center;
    }
    td[data-tipo="estado"] + td,
    td[data-tipo="estado"] + td input {
      min-width: 5ch;  /* aumenta para 6ch ou mais conforme preferires */
      width: 5ch;
      max-width: none;
      padding-left: 0;
      padding-right: 0;
      /* podes ajustar aqui se quiseres mais espaço */
    }
    td input[type="number"]::-webkit-outer-spin-button,
    td input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    td input[type="number"] {
      -moz-appearance: textfield; /* Firefox */
    }

    td[data-tipo="estado"] { border-right: none; }
    td[data-tipo="estado"] + td { border-left: none; }

    /* Sticky 1ª coluna (“Total em Falta”) */
    th:nth-child(1),
    td:nth-child(1) {
      position: sticky;
      left: 0;
      background-color: white;
      z-index: 2;
    }
    /* Sticky 2ª coluna (“Artigo”) */
    th:nth-child(2),
    td:nth-child(2) {
      position: sticky;
      left: calc(var(--first-col-width) + 1px);
      background-color: white;
      z-index: 3;
    }

    /* === Novos estilos para scroll e sticky header === */
    /* 1) Container com scroll vertical e horizontal */
    #tabela-container {
      max-height: 500px;     /* ajuste conforme necessário */
      overflow: auto;
    }
    /* 2) Garante bordas separadas e largura para scroll horizontal */
    #tabela {
      border-collapse: separate;
      border-spacing: 0;
      width: max-content;
    }
    /* 3) Cabeçalho sticky (linha toda) */
    #tabela thead th {
      position: sticky;
      top: 0;
      background-color: #F3F4F6; /* Tailwind’s bg-gray-200 */
      z-index: 50;               /* elevado para garantir topo sobre linhas de categoria */
    }

    /* 4) Eleva as colunas 1 e 2 acima do conteúdo, mas abaixo do thead geral */
    #tabela th:nth-child(1),
    #tabela td:nth-child(1),
    #tabela th:nth-child(2),
    #tabela td:nth-child(2) {
      z-index: 40;
    }
    /* 5) Cabeçalhos próprios das colunas 1 e 2 acima de tudo */
    #tabela thead th:nth-child(1),
    #tabela thead th:nth-child(2) {
      z-index: 60;
    }
    
    /* 1) Garante layout fixo para respeitar widths */
    #tabela {
      table-layout: fixed;
    }

    /* 2) Força wrap de texto como antes */
    #tabela th,
    #tabela td {
      white-space: normal;
      word-break: break-word;
    }

    /* 3) Larguras específicas para colunas 1 e 2 */
    /* 1ª coluna: só o suficiente para “Total” (5 caracteres) */
    #tabela th:nth-child(1),
    #tabela td:nth-child(1) {
      white-space: nowrap;    /* impede quebra em duas linhas */
      width: auto;            /* deixa o browser ajustar à largura do conteúdo */
      min-width: 5ch;         /* mínima aceitável para "Total" */
      max-width: 30ch;        /* evita ocupar largura excessiva */
    }

    /* 2ª coluna: mais apertada */
    #tabela th:nth-child(2),
    #tabela td:nth-child(2) {
      width: 17ch;              /* ajusta entre 6ch–10ch conforme o teu conteúdo */
      max-width: 17ch;
    }

    /* 3ª coluna em diante: mais estreitas e títulos podem quebrar linha */
    #tabela th:nth-child(n+3),
    #tabela td:nth-child(n+3) {
      width: 4ch;           /* ajusta conforme necessário, p.ex. 6ch–8ch */
      max-width: 8ch;
      white-space: normal;  /* permite quebra de linha */
      word-break: break-word;
      text-align: center;   /* opcional: centraliza o conteúdo */
    }

    /* Força a largura da célula do ícone e do cabeçalho correspondente */
    td[data-tipo="estado"],
    th[data-tipo="estado"] {
      width: 1.5em;
      min-width: 1.5em;
      max-width: 1.5em;
      padding-left: 0;
      padding-right: 0;
      text-align: center;
    }

    tr.categoria td {
      background: #fff !important;
      font-weight: bold;
      text-align: left;
      border-bottom: 1px solid #4B5563;
      border-top: 1px solid #4B5563;
      font-size: 0.75rem; /* igual a text-xs do Tailwind */
      padding-top: 0.25rem;  /* igual a py-1 */
      padding-bottom: 0.25rem;
      padding-left: 0.5rem;  /* igual a px-2 */
      padding-right: 0.5rem;
      position: relative;   /* necessário para controlar z-index */
      z-index: 10;          /* abaixo do thead (z-index:50) e das colunas sticky */
    }

    /* Eleva o dropdown das sugestões acima de todos os stickies e posiciona corretamente */
    #suggestions {
      position: absolute;            /* já era, reforça */
      z-index: 99999;                /* acima de qualquer sticky (thead z-index:60) */
      top: calc(100% + 0.25rem);     /* logo abaixo do input por defeito */
      left: 0;
      width: 100%;
      box-sizing: border-box;
      max-height: 10rem;
      overflow: auto;
      background: white;
    }

    /* Remove/reduce padding in first two columns */
    #tabela td:nth-child(1),
    #tabela th:nth-child(1),
    #tabela td:nth-child(2),
    #tabela th:nth-child(2) {
        padding-left: 0.25rem;  /* 4px */
        padding-right: 0.25rem; /* 4px */
    }

    /* Add borders to header cells */
    #tabela thead th {
        border: 1px solid #E5E7EB;  /* gray-200 */
        border-bottom: 2px solid #D1D5DB;  /* gray-300, slightly stronger bottom border */
        background-color: #F9FAFB;  /* gray-50 */
    }

    #suggestions:empty { display: none; }

    /* Esconder a última coluna (botão X) — mas NÃO nas linhas .categoria */
    #tabela tr:not(.categoria) th:last-child,
    #tabela tr:not(.categoria) td:last-child {
      display: none;
    }

    /* Mostrar a última coluna só em modo edição — também ignorando .categoria */
    body.modo-edicao #tabela tr:not(.categoria) th:last-child,
    body.modo-edicao #tabela tr:not(.categoria) td:last-child {
      display: table-cell;
    }

    
    /* Estado em itálico + animação tipo "máquina de escrever" */
    #estado {
      font-style: italic;
    }

    /* classe que ativa a animação */
    .estado-typing {
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      /* o width será animado por JS com steps, chumbado ao número de caracteres */
      animation: none;
    }

    @keyframes estadoTyping {
      from { width: 0ch; }
      to   { width: var(--estado-ch, 0ch); }
    }


  </style>
</head>
<body class="bg-gray-100 text-gray-900 p-4 text-sm">
  
  <!-- NOVO CABEÇALHO -->
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-xl font-bold text-gray-800">Lista de Compras</h1>
    
    <div class="flex items-center gap-2">
      <button id="modoEdicao" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-emerald-600 rounded-md shadow-sm hover:bg-emerald-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        <span>Edição</span>
      </button>
      <button id="mostrarFaltas" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-red-600 rounded-md shadow-sm hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>Em Falta</span>
      </button>
      <button id="mostrarComprados" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-amber-500 rounded-md shadow-sm hover:bg-amber-600 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>Comprados</span>
      </button>
      <button id="mostrarTudo" class="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-gray-600 rounded-md shadow-sm hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <span>Tudo</span>
      </button>
    </div>
  </div>

<div class="mb-4 flex items-center gap-3">
  <!-- Wrapper relativo só para o input + sugestões -->
  <div class="relative">
    <input id="searchInput" type="text" placeholder="Pesquisar artigo…"
      class="border-2 border-green-200 rounded-md px-2 py-1 w-80"/>
    <ul id="suggestions"
      class="absolute left-0 right-0 mt-1 max-h-40 overflow-auto shadow w-80 bg-white border rounded z-10 text-xs"></ul>
  </div>

  <!-- Mensagens de estado, ao lado do input -->
  <em id="estado" class="text-xs text-gray-600 italic whitespace-nowrap"></em>
</div>

  <!-- Container que dá scroll à tabela inteira -->
  <div id="tabela-container">
    <div id="tabela"></div>
  </div>

  <script>
    /* Atualiza --first-col-width com a largura da 1ª célula */
    function updateStickyOffset() {
      const tbl = document.querySelector('#tabela table');
      if (!tbl) return;
      const firstCell = tbl.querySelector('tr > *');
      tbl.style.setProperty('--first-col-width',
        firstCell.getBoundingClientRect().width + 'px'
      );
    }
    window.addEventListener('resize', updateStickyOffset);
    // chamado no final de ui.js, após renderizar a tabela :contentReference[oaicite:1]{index=1}
  </script>

  <script type="module" src="js/main.js"></script>
</body>
</html>
